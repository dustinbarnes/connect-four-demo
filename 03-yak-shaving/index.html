
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dustinbarnes.github.io/connect-four-demo/03-yak-shaving/">
      
      
        <link rel="prev" href="../02-authentication-api/">
      
      
        <link rel="next" href="../04-authentication-backend/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>03: Yak Shaving - Connect Four Demo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#03-yak-shaving" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Connect Four Demo" class="md-header__button md-logo" aria-label="Connect Four Demo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Connect Four Demo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              03: Yak Shaving
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Connect Four Demo" class="md-nav__button md-logo" aria-label="Connect Four Demo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Connect Four Demo
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connect Four Demo Project
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-inception/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00: Inception
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-bookkeeping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01: Bookkeeping
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-authentication-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02: Authentication API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    03: Yak Shaving
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    03: Yak Shaving
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-basics" class="md-nav__link">
    <span class="md-ellipsis">
      Project Basics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gradle-vs-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Gradle vs Maven
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistence" class="md-nav__link">
    <span class="md-ellipsis">
      Persistence
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-authentication-backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04: Authentication Backend
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-authentication-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05: Authentication Service
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-yak-shaving-redux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06: Yak Shaving Redux
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-basics" class="md-nav__link">
    <span class="md-ellipsis">
      Project Basics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gradle-vs-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Gradle vs Maven
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistence" class="md-nav__link">
    <span class="md-ellipsis">
      Persistence
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="03-yak-shaving">03: Yak Shaving</h1>
<p>I refer you to <a href="https://www.youtube.com/watch?v=CrJUhtHdGQ8">this YouTube video</a>, which features a clip from the TV show <em>Malcolm in the Middle</em>. In it, Hal has to change a light bulb but he keeps running into other things he has to do first, to the point that he's working on his car engine to replace the light bulb. </p>
<p>I've also heard it more directly as: </p>
<blockquote>
<p>[MIT AI Lab, after 2000: orig. probably from a Ren &amp; Stimpy episode.] Any seemingly pointless activity which is actually necessary to solve a problem which solves a problem which, several levels of recursion later, solves the real problem you're working on.</p>
</blockquote>
<p>If I went from our current state to our next state, which is generated API stubs that pair with our implementation code, you'd find me making decisions about Maven vs Gradle, persistence layers, other things that feel unrelated to implementing an API, but are the annoying necessary things that need to be in place. </p>
<h2 id="project-basics">Project Basics</h2>
<p>The first choices cover the basics, and may or may not be set for you at your organization. Since this is greenfield project, we'll go with the newest stuff:</p>
<ul>
<li>Java 21</li>
<li>Spring Boot 3<ul>
<li>Generate controller from OpenAPI spec</li>
<li>with Spring Web</li>
<li>with Spring Security</li>
</ul>
</li>
<li>Gradle w/ Kotlin (see below)</li>
</ul>
<p>At this point, in your organization, you may have project starter templates to help with generating new projects. I do not, so I used <a href="https://start.spring.io/">Spring Initializr</a> which allows you to create a project very quickly. The generated project was extracted to the 'backend/' directory. </p>
<h3 id="gradle-vs-maven">Gradle vs Maven</h3>
<p>I have long espoused the benefits of Maven, where I generally think builds should be declarative instead of imperative, it should be hard to do bad things, and the "boringness" of Maven translates to the tooling being extremely capable and mature. I worried that the freedom of Gradle will create more unique snowflake builds, that too much custom logic will seep into the builds, that undisciplined developers wouldn't take the time to understand the tooling, but instead hack in solutions, all leading to an eventual problem when builds are no longer idempotent.</p>
<p>However, I haven't given Gradle a genuine shot in several years. Many, many smart people have migrated. It's hard to argue with the skill, scope, or scale of things like Android and Spring Boot. Therefore, I want to challenge myself and give this a genuine shot.</p>
<h2 id="persistence">Persistence</h2>
<p>In order to keep persistance light at this point, we're going with the venerable SQLite. A very capable, extraordinarily stable SQL server that operates from a single file. It's not a database for scaling out to "web scale", but it's very quick and uses minimal resources. Its fitness for purpose for a small project like this? Perfect. </p>
<p>We still want to practice API first, and I think the tool 'atlas' is a solid fit here. It allows you to define your SQL schema as code, and then it will create migration files for you that you can check in and execute. </p>
<p>I've created a minimal Users table, and you can run <code>npm run build</code> in the terminal to perform the schema application. From here on out, you just modify the <code>schema.hcl</code> file, and atlas will take care of migrations. </p>
<p>The first migration looks like this: </p>
<pre><code>&gt; database@1.0.0 build
&gt; atlas schema apply --url &quot;sqlite://dev.db&quot; --to file://schema.hcl

Planning migration statements (2 in total):

  -- create &quot;users&quot; table:
    -&gt; CREATE TABLE `users` (
         `id` integer NOT NULL PRIMARY KEY AUTOINCREMENT,
         `username` text NOT NULL,
         `password_hash` text NOT NULL,
         `created_at` datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP)
       );
  -- create index &quot;username_unique&quot; to table: &quot;users&quot;:
    -&gt; CREATE UNIQUE INDEX `username_unique` ON `users` (`username`);

-------------------------------------------

Applying approved migration (2 statements in total):

  -- create &quot;users&quot; table
    -&gt; CREATE TABLE `users` (
         `id` integer NOT NULL PRIMARY KEY AUTOINCREMENT,
         `username` text NOT NULL,
         `password_hash` text NOT NULL,
         `created_at` datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP)
       );
  -- ok (1.033125ms)

  -- create index &quot;username_unique&quot; to table: &quot;users&quot;
    -&gt; CREATE UNIQUE INDEX `username_unique` ON `users` (`username`);
  -- ok (59.375µs)

  -------------------------
  -- 1.146458ms
  -- 1 migration
  -- 2 sql statements
</code></pre>
<p>You'll find this work in the <a href="../database">../database</a> directory. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>